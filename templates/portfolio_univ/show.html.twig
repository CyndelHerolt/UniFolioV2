{% extends 'base.html.twig' %}

{% block title %}UniFolio - Dashboard{% endblock %}

    {% block header %}
    {% endblock %}

{% block main %}
    {% import 'macros/breadcrumbs.twig' as breadcrumb_macros %}
    {{ breadcrumb_macros.breadcrumbs([
        {'name': 'Accueil', 'url': '/'},
        {'name': 'Dashboard', 'url': '/etudiant/dashboard'},
        {'name': 'Bibliothèque de portfolios universitaires', 'url': '/etudiant/portfolioUniv'},
        {'name': 'Portfolio' , 'url': null}
    ]) }}

    <section class="container-custom min-vh-100 section-pt">
        <div class="row d-flex">
            <article class="col-lg-8 col-12">
                <div class="card p-0 h-100">
                    <div class="portfolio-banner" style="background-image: url({{ portfolio.banniere }})"></div>
                    <div class="card-header p-5 m-5 mt-0 mb-0">
                        <h2 class="text-center mb-5">{{ portfolio.libelle }}</h2>
                        <p>{{ portfolio.etudiant.prenom }} {{ portfolio.etudiant.nom }}</p>
                        <p class="text-muted">{{ portfolio.annee.libelleLong }}</p>


                        <p>{{ portfolio.description }}</p>
                    </div>

                    <div class="card-body p-5 m-5 mb-0 mt-0">

                        {% for page in pages.currentPageResults %}
                            {% if page.apcNiveau is not null %}
                                {% set competence = page.apcNiveau.apcCompetence %}
                            {% elseif page.apcApprentissageCritique is not null %}
                                {% set competence = page.apcApprentissageCritique.apcNiveau.apcCompetence %}
                            {% endif %}
                            <h2 class="pill-competence d-flex gap-1 align-items-center {{ competence.couleur }}">{{ page.libelle }}</h2>

                            {% if tracesPage is empty %}
                                <div class="alert alert-warning w-100">Aucune trace pour le moment</div>
                            {% else %}

                                {% for trace in tracesPage %}
                                    <div class="col-12 panel_link mt-5 mb-5">
                                        <a href="{{ path('app_trace_show', {'id': trace.id, 'portfolio': portfolio.id, 'page': page.id}) }}"
                                           class="panel_link">
                                            <twig:TracePortfolioPreview id="{{ trace.id }}"/>
                                        </a>
                                    </div>
                                {% endfor %}
                            {% endif %}

                            <hr>
                            <div>
                                <h4>Validation de la compétence {{ page.libelle }}</h4>

                                <table>
                                    <thead>
                                    <tr>
                                        <th>
                                            Critère
                                        </th>
                                        <th>
                                            Resultat
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for critereCompetence in criteresCompetences %}
                                        <tr>
                                            <td>
                                                {{ critereCompetence.critere.libelle }}
                                            </td>
                                            <td>
                                                {% if critereCompetence.valeur is null %}
                                                    <span class="text-muted">En attente</span>
                                                {% else %}
                                                    {{ critereCompetence.valeur }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endfor %}

                        <div class=" navigation text-end">
                            {% if pages.hasPreviousPage %}
                                <a href="{{ path('app_portfolio_univ_show', {'id': portfolio.id, 'page': pages.previousPage}) }}"
                                   class="m-2">Page précédente</a>
                            {% endif %}

                            <span class="m-2">{{ pages.currentPage }}</span>
                            {% if pages.nbPages > 1 %}
                                <span class="m-2">/</span>
                                <a href="{{ path('app_portfolio_univ_show', {'id': portfolio.id, 'page': pages.nbPages}) }}"
                                   class="m-2">{{ pages.nbPages }}</a>
                            {% endif %}

                            {% if pages.hasNextPage %}
                                <a href="{{ path('app_portfolio_univ_show', {'id': portfolio.id, 'page': pages.nextPage}) }}"
                                   class="m-2">Page suivante</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </article>
            <aside class="col-lg-4 col-12">
                <div class="card p-0 h-100">
                    <div class="card-header">

                    </div>
                </div>
            </aside>
        </div>
    </section>
{% endblock %}
